{% load custom_filters %}
{% load static %}
{% if licenses %}
    {% for license in licenses %}
        <tr>
            <td>{{forloop.counter}}</td>
            <td>{{ license.name }}</td>
            <td>{{ license.license_type.name }}</td>
            <td>{{ license.seats }}</td>
            <td>{% if not license.vendor %}-{% else %} {{ license.vendor.name }} {% endif %}</td>
            <td>
                <div class="d-flex flex-column">
                    {% if license.is_assigned %}
                    <div class="d-flex pb-1">
                        {% with map=assigned_user|get_item:license.id %}
                        {% if map.image %}
                        <span class="me-2">
                            <img src="{{ map.image.url }}"
                                onerror="this.onerror=null; this.src='{% static 'assets/images/faces/1.jpg' %}';"
                                class="rounded-circle mb-1" style="width: 20px; height: 20px;" />
                        </span>
            
                        {% else %}
                        <span class="me-2">
                            <img src="{% static 'assets/images/faces/1.jpg' %}" class="rounded-circle mb-1"
                                style="width: 20px; height: 20px;" />
                        </span>
                        {% endif %}
            
                        {% with parts=map.name|split%}
                        {% for part in parts %}
                        <span>{{ part }}</span>
                        {% endfor %}
                        {% endwith %}
                        {% endwith %}
                    </div>
                    <form action="{% url 'license:unassign_license' license.id %}" method="post"
                        onsubmit="return confirm('Are you sure you want to unassign this?')">
                        {% csrf_token %}
                        <button type="submit" value="Delete" class="btn btn-sm btn-danger">Unassign</button>
                    </form>
                    {% else %}
                    <div class="input-group">
                        <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal"
                            data-bs-target="#assign-license-list-modal">
                            Assign
                        </button>
                    </div>
                    {% endif %}
                </div>
            
                <div class="modal fade" id="assign-license-list-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content" id="assign-license-modal-content"
                            hx-get="{% url 'license:assign_license' license.id %}" hx-trigger="revealed" hx-target="this"
                            hx-swap="innerHTML">
                        </div>
                    </div>
                </div>
            </td>
            <td>{% if not license.start_date %}-{% else %} {{ license.start_date|date:"M d, Y" }} {% endif %}</td>
            <td>{% if not license.end_date %}-{% else %} {{ license.end_date|date:"M d, Y" }} {% endif %}</td>
            <td>
                <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                    {% if perms.authentication.view_product %}
                    <a href="{% url 'license:license_details' license.id %}" class="btn btn-success"><i
                            class="bi bi-eye-fill"></i></a>
                    {% endif %}
                    {% if perms.authentication.edit_product %}
                    <a type="button" class="btn btn-info" href="{% url 'license:update_license' license.id %}"><i
                            class="bi bi-pencil-square"></i></a>
                    {% endif %}
                    {% if perms.authentication.delete_product %}
                    <form action="{% url 'license:delete_license' license.id %}" method="post"
                        onsubmit="return confirm('Are you sure you want to delete this?')">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-trash3-fill"></i></button>
                    </form>
                    {% endif %}
                </div>
            </td>
        </tr>
    {% endfor %}
{% else %}
    <div class="alert alert-info" role="alert">
        No record available!
    </div>
{% endif %}