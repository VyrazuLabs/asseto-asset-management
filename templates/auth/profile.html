{% extends 'layouts/main-layout.html' %}
{% load static %}
{% block content %}
<div class="page-heading">
    <h3>Profile</h3>
</div>
<div class="page-content">
    <section class="row">
        <div class="col-12 col-lg-4">
            <div class="card">
                <div class="card-body">
                    <div class="row gallery">
                        <div class="col-12 mb-2">
                        {% if user.profile_pic %}
                            <img class="w-50 active" src="{{request.user.profile_pic.url}}">               
                        {% else %}
                            <img class="w-50 active" src="{% static 'assets/images/faces/1.jpg' %}">
                        {% endif %}
                        </div>
                        <h6 class="my-3">
                            <i class="bi bi-person-badge"></i>
                            <span>Contact Information</span>
                        </h6>
                        <p><i class="bi bi-telephone-fill"></i>&nbsp; {{request.user.phone}}</p>
                        <p><i class="bi bi-envelope-fill"></i>&nbsp; {{request.user.email}}</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- update basic details modal -->
        <div class="modal fade text-left" id="update-basic-modal" tabindex="-1" role="dialog"
            aria-labelledby="myModalLabel160" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div id="update-basic-modal-content" class="modal-content" hx-target="this"></div>
            </div>
        </div>
        <!-- update organization details modal -->
        <div class="modal fade text-left" id="update-organization-modal" tabindex="-1" role="dialog"
            aria-labelledby="myModalLabel160" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div id="update-organization-modal-content" class="modal-content" hx-target="this"></div>
            </div>
        </div>
        <div class="col-12 col-lg-8">
            <div class="card">
                <div class="card-body">
                    <h6 class="my-3">
                        <i class="bi bi-person-fill"></i>
                        <span>Basic Information</span>          
                        <button type="button" class="btn float-end" data-bs-toggle="modal" 
                            hx-get="{% url 'authentication:profile_basic_info_update' %}" hx-target="#update-basic-modal-content"
                            data-bs-toggle="modal" data-bs-target="#update-basic-modal"
                        ><i class="bi bi-pencil-fill"></i> </button>             
                    </h6>
                    <table class="table table-borderless">

                        <tr>
                            <td><b>Full Name</b></td>
                            <td>{{full_name}}</td>
                        </tr>

                        {% if request.user.username %}
                            <tr>
                                <td><b>Username</b></td>
                                <td>{{request.user.username}}</td>
                            </tr>
                        {% endif %}

                        {% if request.user.is_superuser %}
                            <tr>
                                <td><b>Designation</b></td>
                                <td>Administrator</td>
                            </tr>
                        {% else %}
                            <tr>
                                <td><b>Designation</b></td>
                                <td>{{request.user.role}}</td>
                            </tr>
                        {% endif %}

                        {% if request.user.address %}
                            <tr>
                                <td><b>Address</b></td>
                                <td>{{request.user.address}}</td>
                            </tr>
                        {% endif %}
                    </table>
                </div>
            </div>

            {% if request.user.department %}
                <div class="card">
                    <div class="card-body">
                        <h6 class="my-3">
                            <i class="bi bi-person-video3"></i>
                            <span>Department Information</span>          
                        </h6>
                        <table class="table table-borderless">
                            <tr>
                                <td><b>Department</b></td>
                                <td>{{request.user.department}}</td>
                            </tr>
            
                            <tr>
                                <td><b>Contact Person Name</b></td>
                                <td>{{request.user.department.contact_person_name}}</td>
                            </tr>
                            <tr>
                                <td><b>Contact Person Number</b></td>
                                <td>{{request.user.department.contact_person_phone}}</td>
                            </tr>
                            <tr>
                                <td><b>Contact Person Email</b></td>
                                <td>{{request.user.department.contact_person_email}}</td>
                            </tr>   
                        </table>
                    </div>
                </div>
            {% endif %}

            {% if request.user.is_superuser %}
                <div class="card">
                    <div class="card-body">
                        <h6 class="my-3">
                            <i class="bi bi-building"></i>
                            <span>Organization Information</span>
                            <button type="button" class="btn float-end" 
                                hx-get="{% url 'authentication:organization_info_update' %}" hx-target="#update-organization-modal-content"
                                data-bs-toggle="modal" data-bs-target="#update-organization-modal"
                            > <i class="bi bi-pencil-fill"></i> </button>             
                        </h6>
                        <table class="table table-borderless">
                            <tr>
                                <td><b>Organization Name</b></td>
                                <td>{{request.user.organization.name}}</td>
                            </tr>
                            <tr>
                                <td><b>Organization Website</b></td>
                                <td>{{request.user.organization.website|urlize}}</td>
                            </tr>
                            <tr>
                                <td><b>Organization Email</b></td>
                                <td>{{request.user.organization.email}}</td>
                            </tr>
                            <tr>
                                <td><b>Organization Phone</b></td>
                                <td>{{request.user.organization.phone}}</td>
                            </tr>
    
                            <tr>
                                <td><b>Organization Currency</b></td>
                                <td>{{request.user.organization.currency}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            {% endif %}

            {% if not request.user.is_superuser %}
                <div class="card">
                    <div class="card-body">
                        <h6 class="my-3">
                            <i class="bi bi-building"></i>
                            <span>Company Information</span>
                        </h6>
                        <table class="table table-borderless">
                            <tr>
                                <td><b>Company Name</b></td>
                                <td>{{request.user.location.office_name}}</td>
                            </tr>
                            <tr>
                                <td><b>Company Address</b></td>
                                <td>{{request.user.location.address}}</td>
                            </tr>
                            <tr>
                                <td><b>Contact Person Name</b></td>
                                <td>{{request.user.location.contact_person_name}}</td>
                            </tr>
                            <tr>
                                <td><b>Contact Person Number</b></td>
                                <td>{{request.user.location.contact_person_phone}}</td>
                            </tr>
                            <tr>
                                <td><b>Contact Person Email</b></td>
                                <td>{{request.user.location.contact_person_email}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            {% endif %}
            {% if request.user.is_superuser %}
                <div class="card">
                    <div class="card-body">
                        <h6 class="my-3">
                            <i class="bi bi-gear-wide"></i>
                            <span>Notification Settings</span>
                        </h6>
                        <form 
                            hx-post="{% url 'users:create_user_notification_type' %}" 
                            hx-trigger="change" 
                            hx-include="this" 
                            hx-swap="none"
                        >
                            {% csrf_token %}
                            <table class="table table-borderless">
                                <tr>
                                    <td><b>Email Notification</b></td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input 
                                                type="checkbox"
                                                name="email_notification"
                                                class="form-check-input"
                                                style="cursor: pointer;"
                                                {% if email_notification is True %} checked {% endif %}
                                            >
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><b>In-App Notification</b></td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input 
                                                type="checkbox"
                                                name="in_app_notification"
                                                class="form-check-input"
                                                style="cursor: pointer;"
                                                {% if inapp_notification is True %} checked {% endif %}
                                            >
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><b>Browser Notification</b></td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input 
                                                type="checkbox"
                                                name="browser_notification"
                                                class="form-check-input"
                                                style="cursor: pointer;"
                                                {% if browser_notification is True %} checked {% endif %}
                                            >
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><b>Slack Notification</b></td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input 
                                                type="checkbox"
                                                name="slack_notification"
                                                class="form-check-input"
                                                style="cursor: pointer;"
                                                {% if slack_notification is True %} checked {% endif %}
                                            >
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
            {% endif %}
            {% if assigned_assets is not None %}
                <div class="card">
                    <div class="card-body">
                        <h6 class="my-3">
                            <i class="bi bi-people-fill"></i>
                            <span>Assigned Assets</span>                       
                        </h6>                        
                        <div class="table-responsive">
                            <table class="table table-borderless">
                                <tr>
                                    <td><b>Sl No.</b></td>
                                    <td>Asset Images</td>
                                    <td><b>Asset Tag</b></td>
                                    <td><b>Asset Name</b></td>
                                    <td>Type</td>
                                    <td>Vendor Name</td>
                                    <td><b>Assigned Date</b></td>
                                </tr>
                                {% for assigned_asset in assigned_assets %}
                                    <tr>
                                        <td>{{assigned_assets.start_index|add:forloop.counter0}}</td>
                                    
                                        <td>
                                            {% with assigned_asset.asset.images.all as images %}
                                                <div class="asset-thumbnail">
                                                    {% if images %}
                                                        <img src="{{ images.0.image.url }}"
                                                            onerror="this.onerror=null; this.src='{% static 'assets/images/No_Image.jpg' %}';"
                                                            class="img-fluid"
                                                            style="width: 150px; height: 150px; object-fit: cover; border: none; cursor: pointer;"
                                                            onclick="openAssetModal('carouselModal{{ assigned_asset.asset.id }}')"
                                                            >
                                                    {% else %}
                                                        <img src="{% static 'assets/images/No_Image.jpg' %}"
                                                            style="width: 150px; height: 150px; object-fit: cover; border: none;">
                                                    {% endif %}
                                                </div>
                                            {% endwith %}
                                        </td>
                                        <td>{{assigned_asset.asset.tag}}</td>
                                        <td>{{assigned_asset.asset.name}}</td>
                                        <td>{{assigned_asset.asset.product.name}}</td>
                                        <td>{{assigned_asset.asset.vendor}}</td>
                                        <td>{{assigned_asset.assigned_date|date:"D, M d, Y"}}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                            <div class="dataTable-bottom">
                                Showing {{ assigned_assets.start_index }} to {{ assigned_assets.end_index }} of {{ assigned_assets.paginator.count }} entries
                            </div>

                            <nav aria-label="Page navigation example">
                                <ul class="pagination pagination-primary justify-content-end">

                                    <li class="page-item {% if not assigned_assets.has_previous %} disabled {% endif %}">
                                    <a class="page-link" 
                                        {% if assigned_assets.has_previous %}
                                        href="?assets_page={{ assigned_assets.previous_page_number }}&page={{ page_object.number }}"
                                        {% endif %}
                                        tabindex="-1" aria-disabled="true">« Previous</a>
                                    </li>

                                    {% for i in assigned_assets.paginator.page_range %}
                                    <li class="page-item {% if assigned_assets.number == i %} active {% endif %}">
                                        <a class="page-link" href="?assets_page={{ i }}&page={{ page_object.number }}">{{ i }}</a>
                                    </li>
                                    {% endfor %}

                                    <li class="page-item {% if not assigned_assets.has_next %} disabled {% endif %}">
                                    <a class="page-link" 
                                        {% if assigned_assets.has_next %}
                                        href="?assets_page={{ assigned_assets.next_page_number }}&page={{ page_object.number }}"
                                        {% endif %}
                                    >Next »</a>
                                    </li>

                                </ul>
                            </nav>
                        </div>
                        {% for assigned_asset in assigned_assets %}
                            {% with assigned_asset.asset.images.all as images %}
                                {% if images %}
                                    <div class="modal fade" id="carouselModal{{ assigned_asset.asset.id }}" tabindex="-1" aria-labelledby="carouselModalLabel{{ assigned_asset.asset.id }}" aria-hidden="true">
                                        <div class="modal-dialog modal-lg modal-dialog-centered">
                                            <div class="modal-content">

                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="carouselModalLabel{{ assigned_asset.asset.id }}">Asset Images</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>

                                                <div class="modal-body p-0">
                                                    <div id="carousel{{ assigned_asset.asset.id }}" class="carousel slide" data-bs-ride="carousel">
                                                        <div class="carousel-inner">
                                                            {% for image in images %}
                                                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                                                    <img class="d-block w-100"
                                                                        onerror="this.onerror=null; this.src='{% static 'assets/images/No_Image.jpg' %}';"
                                                                        src="{{ image.image.url }}"
                                                                        alt="Asset Image"
                                                                        style="object-fit: contain; max-height: 600px;">
                                                                </div>
                                                            {% endfor %}
                                                        </div>

                                                        {% if images|length > 1 %}
                                                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ assigned_asset.asset.id }}" data-bs-slide="prev">
                                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                            </button>
                                                            <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ assigned_asset.asset.id }}" data-bs-slide="next">
                                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                            </button>
                                                        {% endif %}
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            
        </div>
    </section>
</div>
{% endblock content %}